name: Security Scan
on:
  pull_request:
    branches: [main]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: TruffleHog Scan
        run: |
          docker run --rm -v "$PWD:/scan" \
          trufflesecurity/trufflehog:latest \
          filesystem /scan --fail
      
      - name: Gitleaks Scan
        run: |
          docker run --rm -v "$PWD:/repo" \
          zricethezav/gitleaks:latest \
          detect --source /repo --no-git --exit-code 1
